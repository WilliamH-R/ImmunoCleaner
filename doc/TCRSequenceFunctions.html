<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.0.36">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="William Hagedorn-Rasmussen">

<title>Exploring CD8+ T-cell Specificities using Single Cell Immune Profiling with an Outlook to Reproducible Bio Data Science</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>


<script src="TCRSequenceFunctions_files/libs/clipboard/clipboard.min.js"></script>
<script src="TCRSequenceFunctions_files/libs/quarto-html/quarto.js"></script>
<script src="TCRSequenceFunctions_files/libs/quarto-html/popper.min.js"></script>
<script src="TCRSequenceFunctions_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="TCRSequenceFunctions_files/libs/quarto-html/anchor.min.js"></script>
<link href="TCRSequenceFunctions_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="TCRSequenceFunctions_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="TCRSequenceFunctions_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="TCRSequenceFunctions_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="TCRSequenceFunctions_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#sec-Import" id="toc-sec-Import" class="nav-link active" data-scroll-target="#sec-Import"> <span class="header-section-number">1</span> Imports</a></li>
  <li><a href="#sec-Intro" id="toc-sec-Intro" class="nav-link" data-scroll-target="#sec-Intro"> <span class="header-section-number">2</span> Introduction</a></li>
  <li><a href="#sec-TidyData" id="toc-sec-TidyData" class="nav-link" data-scroll-target="#sec-TidyData"> <span class="header-section-number">3</span> Tidying the data</a>
  <ul class="collapse">
  <li><a href="#sec-CleaningData" id="toc-sec-CleaningData" class="nav-link" data-scroll-target="#sec-CleaningData"> <span class="header-section-number">3.1</span> Cleaning</a></li>
  <li><a href="#sec-AugmentingData" id="toc-sec-AugmentingData" class="nav-link" data-scroll-target="#sec-AugmentingData"> <span class="header-section-number">3.2</span> Augmenting</a></li>
  <li><a href="#change-of-dimensions" id="toc-change-of-dimensions" class="nav-link" data-scroll-target="#change-of-dimensions"> <span class="header-section-number">3.3</span> Change of dimensions</a></li>
  </ul></li>
  <li><a href="#sec-ModelData" id="toc-sec-ModelData" class="nav-link" data-scroll-target="#sec-ModelData"> <span class="header-section-number">4</span> Modelling</a></li>
  <li><a href="#sec-Shiny" id="toc-sec-Shiny" class="nav-link" data-scroll-target="#sec-Shiny"> <span class="header-section-number">5</span> Shiny Integration</a></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References</a></li>
  <li><a href="#sec-Appendix" id="toc-sec-Appendix" class="nav-link" data-scroll-target="#sec-Appendix"> <span class="header-section-number">6</span> Appendix</a>
  <ul class="collapse">
  <li><a href="#sec-AppendixA" id="toc-sec-AppendixA" class="nav-link" data-scroll-target="#sec-AppendixA"> <span class="header-section-number">6.1</span> Appendix A</a></li>
  </ul></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Exploring CD8+ T-cell Specificities using Single Cell Immune Profiling with an Outlook to Reproducible Bio Data Science</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>William Hagedorn-Rasmussen </p>
          </div>
  </div>
    
    
  </div>
  

</header>

<section id="sec-Import" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Imports</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(TCRSequenceFunctions)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gt)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="sec-Intro" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Introduction</h1>
<p>This package, <a href="https://github.com/WilliamH-R/TCRSequenceFunctions">TCRSequenceFunctions</a>, is a collection of functions made for working with data sets from a Single Cell Immune Profiling experiment made by 10x Genomics <span class="citation" data-cites="10XGenomics2022">[<a href="#ref-10XGenomics2022" role="doc-biblioref">1</a>]</span>. There is a total of four data sets which all follow the same general structure. They differ in that, they contain data from each their own respective donor.</p>
<p>The data sets contains binding counts between the donorsâ€™ library of T-Cell Receptors (TCRs) and a set of peptide-major histocompatibility complexes (pMHCs). The before-mentioned binding counts are so called unique molecular identifier (UMI) counts. For an explanation of all columns see <a href="#sec-AppendixA">Section&nbsp;6.1</a>.</p>
<p>In the following sections, each of the functions contained in <a href="https://github.com/WilliamH-R/TCRSequenceFunctions">TCRSequenceFunctions</a> will be explained, demonstrated and reasoned for. Generally, they can be divided into three types: Cleaning, Augmenting and Modelling where the main goal of the two first is to make the data tidy.</p>
<p>Lastly will be a short section on a Shiny Package, <a href="https://github.com/WilliamH-R/TCRSequenceShiny">TCRSequenceShiny</a>, which utilizes these functions to make a user-friendly interactive interface for data exploration.</p>
</section>
<section id="sec-TidyData" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Tidying the data</h1>
<p>The aim of tidying the data is to enable the data handling, and to ensure a reproducible result. Firstly, the data is cleaned e.g.&nbsp;by making sure, all cells only contain one piece of information. Afterwards, some augmented was needed to enable the modelling. This was done by e.g.&nbsp;adding new columns. A wrapper function was used to run all the preparation functions: <code>run_all_prep()</code>. This wrapper simply takes one of the raw data files included in the package as input, and pipe it through all the preparation functions, and output tidy data as in <a href="#lst-tidydata_pipeline">Listing&nbsp;3.1</a>.</p>
<div id="lst-tidydata_pipeline" class="listing">
<p>Listing 3.1: How to pipe data through wrapper</p>
<div class="sourceCode" id="lst-tidydata_pipeline" data-lst-cap="How to pipe data through wrapper"><pre class="sourceCode R code-with-copy"><code class="sourceCode r"><span id="lst-tidydata_pipeline-1"><a href="#lst-tidydata_pipeline-1" aria-hidden="true" tabindex="-1"></a>data_donor_one_raw <span class="sc">%&gt;%</span></span>
<span id="lst-tidydata_pipeline-2"><a href="#lst-tidydata_pipeline-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">run_all_prep</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="sec-CleaningData" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="sec-CleaningData"><span class="header-section-number">3.1</span> Cleaning</h2>
<p>As mentioned above, cleaning the data is mostly focusing on handling already present data and/or re-structure the data frame. The list of cleaning functions are as follows:</p>
<ol type="1">
<li><code>remove_unnecessary_columns()</code></li>
<li><code>find_non_promiscuous_split_TCR_sequences()</code></li>
<li><code>pivot_longer_TCR_sequences()</code></li>
<li><code>add_chain_ident_remove_prefix()</code></li>
<li><code>pivot_longer_pMHC()</code></li>
<li><code>tidy_pMHC_names()</code></li>
</ol>
<p>The first function takes the raw data frame as input, and simply removes the unnecessary columns as these arenâ€™t needed. By default, the columns removed are those containing <code>"_binder"</code> and the column <code>"cell_clono_cdr3_nt"</code>.</p>
<p><code>find_non_promiscuous_split_TCR_sequences()</code>, <code>pivot_longer_TCR_sequence()</code> and <code>add_chain_ident_remove_prefix()</code> works in close relation with one another. The main purpose is to tidy the TCR-sequences, as to not have cells with multiple pieces of information. <a href="#tbl-TCR_sequence_example_before">Table&nbsp;3.1</a> shows three examples as to how these are written. A column is added to indicate a non-promiscuous pair (i.e., a pair with one alpha- and beta chain respectively) and contains the TCR-sequence of said pair. This is done since the sequences of non-promiscuous pairs are needed for modelling in <code>relevant_binder_frequency_plot()</code>. The TCR-sequences are then split into new columns, one for each chain. These new columns are then pivot longer into the column <code>TCR_sequence</code> by <code>pivot_longer_TCR_sequence()</code>. Lastly, a new column is added to indicate chain type, <code>chain</code>, and the chain indicator <code>"TR[A|B]"</code> is removed. The result can be seen in <a href="#tbl-TCR_sequence_example_after">Table&nbsp;3.2</a>.</p>
<div class="cell">
<div class="cell-output-display">
<div id="tbl-TCR_sequence_example_before" class="anchored">

<div id="hqttmasmlz" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#hqttmasmlz .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#hqttmasmlz .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#hqttmasmlz .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#hqttmasmlz .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#hqttmasmlz .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#hqttmasmlz .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#hqttmasmlz .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#hqttmasmlz .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#hqttmasmlz .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#hqttmasmlz .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#hqttmasmlz .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#hqttmasmlz .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#hqttmasmlz .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#hqttmasmlz .gt_from_md > :first-child {
  margin-top: 0;
}

#hqttmasmlz .gt_from_md > :last-child {
  margin-bottom: 0;
}

#hqttmasmlz .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#hqttmasmlz .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#hqttmasmlz .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#hqttmasmlz .gt_row_group_first td {
  border-top-width: 2px;
}

#hqttmasmlz .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#hqttmasmlz .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#hqttmasmlz .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#hqttmasmlz .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#hqttmasmlz .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#hqttmasmlz .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#hqttmasmlz .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#hqttmasmlz .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#hqttmasmlz .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#hqttmasmlz .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-left: 4px;
  padding-right: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#hqttmasmlz .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#hqttmasmlz .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#hqttmasmlz .gt_left {
  text-align: left;
}

#hqttmasmlz .gt_center {
  text-align: center;
}

#hqttmasmlz .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#hqttmasmlz .gt_font_normal {
  font-weight: normal;
}

#hqttmasmlz .gt_font_bold {
  font-weight: bold;
}

#hqttmasmlz .gt_font_italic {
  font-style: italic;
}

#hqttmasmlz .gt_super {
  font-size: 65%;
}

#hqttmasmlz .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 75%;
  vertical-align: 0.4em;
}

#hqttmasmlz .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#hqttmasmlz .gt_indent_1 {
  text-indent: 5px;
}

#hqttmasmlz .gt_indent_2 {
  text-indent: 10px;
}

#hqttmasmlz .gt_indent_3 {
  text-indent: 15px;
}

#hqttmasmlz .gt_indent_4 {
  text-indent: 20px;
}

#hqttmasmlz .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table"><caption>Table 3.1:  A snippet of data_donor_one_raw to show two examples as to how TCR-sequences are written </caption>
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col">cell_clono_cdr3_aa</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td class="gt_row gt_left">TRA:CAASVSIWTGTASKLTF;TRA:CAAWDMEYGNKLVF;TRB:CAISDPGLAGGGGEQFF</td></tr>
    <tr><td class="gt_row gt_left">TRB:CASDTPVGQFF</td></tr>
    <tr><td class="gt_row gt_left">TRA:CASYTDKLIF;TRB:CASSGGSISTDTQYF</td></tr>
  </tbody>
  
  
</table>
</div>
</div>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div id="tbl-TCR_sequence_example_after" class="anchored">

<div id="ouhbrfuzhc" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#ouhbrfuzhc .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#ouhbrfuzhc .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#ouhbrfuzhc .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#ouhbrfuzhc .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#ouhbrfuzhc .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ouhbrfuzhc .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#ouhbrfuzhc .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#ouhbrfuzhc .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#ouhbrfuzhc .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#ouhbrfuzhc .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#ouhbrfuzhc .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#ouhbrfuzhc .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#ouhbrfuzhc .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#ouhbrfuzhc .gt_from_md > :first-child {
  margin-top: 0;
}

#ouhbrfuzhc .gt_from_md > :last-child {
  margin-bottom: 0;
}

#ouhbrfuzhc .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#ouhbrfuzhc .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#ouhbrfuzhc .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#ouhbrfuzhc .gt_row_group_first td {
  border-top-width: 2px;
}

#ouhbrfuzhc .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#ouhbrfuzhc .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#ouhbrfuzhc .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#ouhbrfuzhc .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ouhbrfuzhc .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#ouhbrfuzhc .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#ouhbrfuzhc .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#ouhbrfuzhc .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ouhbrfuzhc .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#ouhbrfuzhc .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-left: 4px;
  padding-right: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#ouhbrfuzhc .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#ouhbrfuzhc .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#ouhbrfuzhc .gt_left {
  text-align: left;
}

#ouhbrfuzhc .gt_center {
  text-align: center;
}

#ouhbrfuzhc .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#ouhbrfuzhc .gt_font_normal {
  font-weight: normal;
}

#ouhbrfuzhc .gt_font_bold {
  font-weight: bold;
}

#ouhbrfuzhc .gt_font_italic {
  font-style: italic;
}

#ouhbrfuzhc .gt_super {
  font-size: 65%;
}

#ouhbrfuzhc .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 75%;
  vertical-align: 0.4em;
}

#ouhbrfuzhc .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#ouhbrfuzhc .gt_indent_1 {
  text-indent: 5px;
}

#ouhbrfuzhc .gt_indent_2 {
  text-indent: 10px;
}

#ouhbrfuzhc .gt_indent_3 {
  text-indent: 15px;
}

#ouhbrfuzhc .gt_indent_4 {
  text-indent: 20px;
}

#ouhbrfuzhc .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table"><caption>Table 3.2:  A snippet of the output from find_non_promiscuous_split_TCR_sequences() to show a tidy version of the TCR-sequences </caption>
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col">TCR_sequence</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col">chain</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col">non_promiscuous_pair</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td class="gt_row gt_left">CAASVSIWTGTASKLTF</td>
<td class="gt_row gt_left">alpha</td>
<td class="gt_row gt_left">NA</td></tr>
    <tr><td class="gt_row gt_left">CAAWDMEYGNKLVF</td>
<td class="gt_row gt_left">alpha</td>
<td class="gt_row gt_left">NA</td></tr>
    <tr><td class="gt_row gt_left">CAISDPGLAGGGGEQFF</td>
<td class="gt_row gt_left">beta</td>
<td class="gt_row gt_left">NA</td></tr>
    <tr><td class="gt_row gt_left">CASDTPVGQFF</td>
<td class="gt_row gt_left">beta</td>
<td class="gt_row gt_left">NA</td></tr>
    <tr><td class="gt_row gt_left">CASYTDKLIF</td>
<td class="gt_row gt_left">alpha</td>
<td class="gt_row gt_left">CASYTDKLIF;CASSGGSISTDTQYF</td></tr>
    <tr><td class="gt_row gt_left">CASSGGSISTDTQYF</td>
<td class="gt_row gt_left">beta</td>
<td class="gt_row gt_left">CASYTDKLIF;CASSGGSISTDTQYF</td></tr>
  </tbody>
  
  
</table>
</div>
</div>
</div>
</div>
<p>A similar process is applied to all column names which follow the general structure: <code>"allele_peptide_peptidesource"</code>. This is done through <code>pivot_longer_pMHC()</code> and <code>tidy_pMHC_names</code>. First the names are pivot longer with their associated UMI-counts as values. Here, only non-zero values are kept as they are otherwise irrelevant. The names, now as rows, are made tidy by splitting into three new columns:</p>
<ol type="1">
<li><p><code>allele</code></p></li>
<li><p><code>peptide</code></p></li>
<li><p><code>peptide_source</code></p></li>
</ol>
<p>This step is important as to not have multiple pieces of information in one cell, and as they are used for modelling in <code>summarise_with_filter()</code>.</p>
</section>
<section id="sec-AugmentingData" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="sec-AugmentingData"><span class="header-section-number">3.2</span> Augmenting</h2>
<p>Generally speaking, augmenting the data refers to adding new columns which enable later modelling. In some cases, it makes more sense to do augmenting while cleaning (e.g.&nbsp;<code>find_non_promiscuous_split_TCR_sequences()</code>). The list of augmenting functions are as follows:</p>
<ol type="1">
<li><code>add_max_non_specific_binder()</code></li>
<li><code>evaluate_binder()</code></li>
<li><code>add_TCR_combination_identifier()</code></li>
</ol>
<p>The first and second function are both required to find the relevant binders. A relevant binder has four requirements which needs to be met:</p>
<ol type="1">
<li>UMI-count needs to be larger than some threshold</li>
<li>The UMI-count has to be another threshold times higher than the non-specific binder with the highest UMI-count for that barcode</li>
<li>If multiple specificities exist, only use the one with the highest UMI-count</li>
<li>Disregard a cell if it shows specificity towards more than four pMHC</li>
</ol>
<p>And so, the purpose of the first function is to find the highest UMI-count of all non-specific binders for each barcode. The count is added in a new column called <code>max_non_specific_binder</code>. The second function then uses the above mentioned requirements to evaluate all binding events. The evaluation is used in e.g.&nbsp;<code>relevant_binder_frequency_plot()</code>. Some examples of evaluation can be seen in <a href="#tbl-binder_evaluation">Table&nbsp;3.3</a>.</p>
<div class="cell">
<div class="cell-output-display">
<div id="tbl-binder_evaluation" class="anchored">

<div id="qkjbxagubn" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#qkjbxagubn .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#qkjbxagubn .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#qkjbxagubn .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#qkjbxagubn .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#qkjbxagubn .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#qkjbxagubn .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#qkjbxagubn .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#qkjbxagubn .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#qkjbxagubn .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#qkjbxagubn .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#qkjbxagubn .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#qkjbxagubn .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#qkjbxagubn .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#qkjbxagubn .gt_from_md > :first-child {
  margin-top: 0;
}

#qkjbxagubn .gt_from_md > :last-child {
  margin-bottom: 0;
}

#qkjbxagubn .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#qkjbxagubn .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#qkjbxagubn .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#qkjbxagubn .gt_row_group_first td {
  border-top-width: 2px;
}

#qkjbxagubn .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#qkjbxagubn .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#qkjbxagubn .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#qkjbxagubn .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#qkjbxagubn .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#qkjbxagubn .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#qkjbxagubn .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#qkjbxagubn .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#qkjbxagubn .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#qkjbxagubn .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-left: 4px;
  padding-right: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#qkjbxagubn .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#qkjbxagubn .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#qkjbxagubn .gt_left {
  text-align: left;
}

#qkjbxagubn .gt_center {
  text-align: center;
}

#qkjbxagubn .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#qkjbxagubn .gt_font_normal {
  font-weight: normal;
}

#qkjbxagubn .gt_font_bold {
  font-weight: bold;
}

#qkjbxagubn .gt_font_italic {
  font-style: italic;
}

#qkjbxagubn .gt_super {
  font-size: 65%;
}

#qkjbxagubn .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 75%;
  vertical-align: 0.4em;
}

#qkjbxagubn .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#qkjbxagubn .gt_indent_1 {
  text-indent: 5px;
}

#qkjbxagubn .gt_indent_2 {
  text-indent: 10px;
}

#qkjbxagubn .gt_indent_3 {
  text-indent: 15px;
}

#qkjbxagubn .gt_indent_4 {
  text-indent: 20px;
}

#qkjbxagubn .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table"><caption>Table 3.3:  Examples of how different combinations of UMI-count and max_non_specific_binder are evaluated </caption>
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col">pMHC</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col">UMI_count</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col">max_non_specific_binder</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr class="gt_group_heading_row">
      <td colspan="3" class="gt_group_heading">FALSE</td>
    </tr>
    <tr class="gt_row_group_first"><td class="gt_row gt_left">A0201_KLQCVDLHV_PSA146-154</td>
<td class="gt_row gt_right">1</td>
<td class="gt_row gt_right">1</td></tr>
    <tr><td class="gt_row gt_left">A1101_AVFDRKSDAK_EBNA-3B_EBV</td>
<td class="gt_row gt_right">2</td>
<td class="gt_row gt_right">1</td></tr>
    <tr><td class="gt_row gt_left">A0201_KLQCVDLHV_PSA146-154</td>
<td class="gt_row gt_right">1</td>
<td class="gt_row gt_right">1</td></tr>
    <tr class="gt_group_heading_row">
      <td colspan="3" class="gt_group_heading">TRUE</td>
    </tr>
    <tr class="gt_row_group_first"><td class="gt_row gt_left">A1101_AVFDRKSDAK_EBNA-3B_EBV</td>
<td class="gt_row gt_right">451</td>
<td class="gt_row gt_right">0</td></tr>
    <tr><td class="gt_row gt_left">A1101_AVFDRKSDAK_EBNA-3B_EBV</td>
<td class="gt_row gt_right">451</td>
<td class="gt_row gt_right">0</td></tr>
    <tr><td class="gt_row gt_left">A1101_AVFDRKSDAK_EBNA-3B_EBV</td>
<td class="gt_row gt_right">451</td>
<td class="gt_row gt_right">0</td></tr>
  </tbody>
  
  
</table>
</div>
</div>
</div>
</div>
<p>Lastly, <code>add_TCR_combination_identifier()</code> categorizes the TCR-sequence chain combinations for each barcode. I.e. it determines which of the following groups the TCR-sequence for a barcode belongs to:</p>
<ol type="1">
<li>Containing only one alpha chain and no beta chains</li>
<li>Containing no alpha chain and only one beta chain</li>
<li>Containing one alpha chain and beta chain respectively</li>
<li>Some other combination</li>
</ol>
<p>This allows for a distribution of the above-mentioned categories to perform a quick check on the data through <code>alpha_beta_pair_distributions()</code>. A few examples can be seen in <a href="#tbl-chain_categorizing">Table&nbsp;3.4</a>.</p>
<div class="cell">
<div class="cell-output-display">
<div id="tbl-chain_categorizing" class="anchored">

<div id="vogzjahjqm" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#vogzjahjqm .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#vogzjahjqm .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#vogzjahjqm .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#vogzjahjqm .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#vogzjahjqm .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#vogzjahjqm .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#vogzjahjqm .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#vogzjahjqm .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#vogzjahjqm .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#vogzjahjqm .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#vogzjahjqm .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#vogzjahjqm .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#vogzjahjqm .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#vogzjahjqm .gt_from_md > :first-child {
  margin-top: 0;
}

#vogzjahjqm .gt_from_md > :last-child {
  margin-bottom: 0;
}

#vogzjahjqm .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#vogzjahjqm .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#vogzjahjqm .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#vogzjahjqm .gt_row_group_first td {
  border-top-width: 2px;
}

#vogzjahjqm .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#vogzjahjqm .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#vogzjahjqm .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#vogzjahjqm .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#vogzjahjqm .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#vogzjahjqm .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#vogzjahjqm .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#vogzjahjqm .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#vogzjahjqm .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#vogzjahjqm .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-left: 4px;
  padding-right: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#vogzjahjqm .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#vogzjahjqm .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#vogzjahjqm .gt_left {
  text-align: left;
}

#vogzjahjqm .gt_center {
  text-align: center;
}

#vogzjahjqm .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#vogzjahjqm .gt_font_normal {
  font-weight: normal;
}

#vogzjahjqm .gt_font_bold {
  font-weight: bold;
}

#vogzjahjqm .gt_font_italic {
  font-style: italic;
}

#vogzjahjqm .gt_super {
  font-size: 65%;
}

#vogzjahjqm .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 75%;
  vertical-align: 0.4em;
}

#vogzjahjqm .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#vogzjahjqm .gt_indent_1 {
  text-indent: 5px;
}

#vogzjahjqm .gt_indent_2 {
  text-indent: 10px;
}

#vogzjahjqm .gt_indent_3 {
  text-indent: 15px;
}

#vogzjahjqm .gt_indent_4 {
  text-indent: 20px;
}

#vogzjahjqm .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table"><caption>Table 3.4:  Examples of how barcodes are categorized depending on their alpha- and beta chain combination </caption>
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col">barcode</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col">chain</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col">TCR_combination</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td class="gt_row gt_left">AAACCTGAGACAAAGG-4</td>
<td class="gt_row gt_left">alpha</td>
<td class="gt_row gt_left">other</td></tr>
    <tr><td class="gt_row gt_left">AAACCTGAGACAAAGG-4</td>
<td class="gt_row gt_left">alpha</td>
<td class="gt_row gt_left">other</td></tr>
    <tr><td class="gt_row gt_left">AAACCTGAGACAAAGG-4</td>
<td class="gt_row gt_left">alpha</td>
<td class="gt_row gt_left">other</td></tr>
    <tr><td class="gt_row gt_left">AAACCTGAGACAAAGG-4</td>
<td class="gt_row gt_left">alpha</td>
<td class="gt_row gt_left">other</td></tr>
    <tr><td class="gt_row gt_left">AAACCTGAGACAAAGG-4</td>
<td class="gt_row gt_left">beta</td>
<td class="gt_row gt_left">other</td></tr>
    <tr><td class="gt_row gt_left">AAACCTGAGACAAAGG-4</td>
<td class="gt_row gt_left">beta</td>
<td class="gt_row gt_left">other</td></tr>
    <tr><td class="gt_row gt_left">AAACCTGAGACTGTAA-34</td>
<td class="gt_row gt_left">beta</td>
<td class="gt_row gt_left">one_beta_only</td></tr>
    <tr><td class="gt_row gt_left">AAACCTGAGACTGTAA-34</td>
<td class="gt_row gt_left">beta</td>
<td class="gt_row gt_left">one_beta_only</td></tr>
    <tr><td class="gt_row gt_left">AAACCTGAGACTGTAA-34</td>
<td class="gt_row gt_left">beta</td>
<td class="gt_row gt_left">one_beta_only</td></tr>
    <tr><td class="gt_row gt_left">AAACCTGAGAGCCCAA-5</td>
<td class="gt_row gt_left">alpha</td>
<td class="gt_row gt_left">one_alpha_one_beta</td></tr>
    <tr><td class="gt_row gt_left">AAACCTGAGAGCCCAA-5</td>
<td class="gt_row gt_left">alpha</td>
<td class="gt_row gt_left">one_alpha_one_beta</td></tr>
  </tbody>
  
  
</table>
</div>
</div>
</div>
</div>
</section>
<section id="change-of-dimensions" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="change-of-dimensions"><span class="header-section-number">3.3</span> Change of dimensions</h2>
<p>Naturally, the dimensions of all included data sets change after being piped through <code>run_all_prep()</code>. <a href="#tbl-dimensions">Table&nbsp;3.5</a> shows the dimensions for both the raw and tidy data sets stratified on donor. The number of columns are always reduced to 27, but the number of rows depend on the original number of rows and the data itself.</p>
<div id="tbl-dimensions" class="tbl-parent quarto-layout-panel anchored">
<div class="panel-caption table-caption">
<p>Table 3.5: Dimensions of data sets for <strong>(a)</strong> Donor 1, <strong>(b)</strong> Donor 2, <strong>(c)</strong> Donor 3 and <strong>(d)</strong> Donor 4 before and after being prepared by the wrapper <code>run_all_prep()</code></p>
</div>
<div class="quarto-layout-row quarto-layout-valign-top">
<div id="tbl-dimensions_donor_one" class="quarto-layout-cell quarto-layout-cell-subref anchored" data-ref-parent="tbl-dimensions" style="flex-basis: 50.0%;justify-content: center;">
<table class="table">
<caption>(a)</caption>
<colgroup>
<col style="width: 27%">
<col style="width: 35%">
<col style="width: 36%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;"><strong>Donor 1</strong></th>
<th style="text-align: center;"><strong><code>raw</code></strong></th>
<th style="text-align: center;"><strong><code>tidy</code></strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><strong>Number of columns</strong></td>
<td style="text-align: center;">118</td>
<td style="text-align: center;">27</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>Number of rows</strong></td>
<td style="text-align: center;">46526</td>
<td style="text-align: center;">512264</td>
</tr>
</tbody>
</table>
</div>
<div id="tbl-dimensions_donor_two" class="quarto-layout-cell quarto-layout-cell-subref anchored" data-ref-parent="tbl-dimensions" style="flex-basis: 50.0%;justify-content: center;">
<table class="table">
<caption>(b)</caption>
<colgroup>
<col style="width: 27%">
<col style="width: 35%">
<col style="width: 36%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;"><strong>Donor 2</strong></th>
<th style="text-align: center;"><strong><code>raw</code></strong></th>
<th style="text-align: center;"><strong><code>tidy</code></strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><strong>Number of columns</strong></td>
<td style="text-align: center;">118</td>
<td style="text-align: center;">27</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>Number of rows</strong></td>
<td style="text-align: center;">77854</td>
<td style="text-align: center;">860757</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="quarto-layout-row quarto-layout-valign-top">
<div id="tbl-dimensions_donor_three" class="quarto-layout-cell quarto-layout-cell-subref anchored" data-ref-parent="tbl-dimensions" style="flex-basis: 50.0%;justify-content: center;">
<table class="table">
<caption>(c)</caption>
<colgroup>
<col style="width: 26%">
<col style="width: 36%">
<col style="width: 37%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;"><strong>Donor 3</strong></th>
<th style="text-align: center;"><strong><code>raw</code></strong></th>
<th style="text-align: center;"><strong><code>tidy</code></strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><strong>Number of columns</strong></td>
<td style="text-align: center;">118</td>
<td style="text-align: center;">27</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>Number of rows</strong></td>
<td style="text-align: center;">37824</td>
<td style="text-align: center;">581484</td>
</tr>
</tbody>
</table>
</div>
<div id="tbl-dimensions_donor_four" class="quarto-layout-cell quarto-layout-cell-subref anchored" data-ref-parent="tbl-dimensions" style="flex-basis: 50.0%;justify-content: center;">
<table class="table">
<caption>(d)</caption>
<colgroup>
<col style="width: 27%">
<col style="width: 35%">
<col style="width: 36%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;"><strong>Donor 4</strong></th>
<th style="text-align: center;"><strong><code>raw</code></strong></th>
<th style="text-align: center;"><strong><code>tidy</code></strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><strong>Number of columns</strong></td>
<td style="text-align: center;">118</td>
<td style="text-align: center;">27</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>Number of rows</strong></td>
<td style="text-align: center;">27308</td>
<td style="text-align: center;">190482</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</section>
</section>
<section id="sec-ModelData" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Modelling</h1>
</section>
<section id="sec-Shiny" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> Shiny Integration</h1>
</section>
<section id="references" class="level1 unnumbered">
<h1 class="unnumbered">References</h1>
</section>
<section id="sec-Appendix" class="level1" data-number="6">
<h1 data-number="6"><span class="header-section-number">6</span> Appendix</h1>
<section id="sec-AppendixA" class="level2 unnumbered" data-number="6.1">


</section>
</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography"><h2 class="anchored quarto-appendix-heading">6.1 Appendix A</h2><div id="refs" class="references csl-bib-body" role="doc-bibliography">
<div id="ref-10XGenomics2022" class="csl-entry" role="doc-biblioentry">
<div class="csl-left-margin">[1] </div><div class="csl-right-inline">10X Genomics. 2022. <span class="nocase">A New Way of Exploring Immunity - Linking Highly Multiplexed Antigen Recognition to Immune Repertoire and Phenotype</span>. <em>10x Genomics</em> (2022), 1â€“13. Retrieved from <a href="https://www.10xgenomics.com/resources/document-library/a14cde">https://www.10xgenomics.com/resources/document-library/a14cde</a></div>
</div>
</div></section></div></main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "î§‹";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      let href = ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</div> <!-- /content -->



</body></html>